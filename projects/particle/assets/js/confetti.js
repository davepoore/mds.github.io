'use strict';var _createClass=function(){function defineProperties(target,props){for(var i=0;i<props.length;i++){var descriptor=props[i];descriptor.enumerable=descriptor.enumerable||!1,descriptor.configurable=!0,'value'in descriptor&&(descriptor.writable=!0),Object.defineProperty(target,descriptor.key,descriptor)}}return function(Constructor,protoProps,staticProps){return protoProps&&defineProperties(Constructor.prototype,protoProps),staticProps&&defineProperties(Constructor,staticProps),Constructor}}();function _defineProperty(obj,key,value){return key in obj?Object.defineProperty(obj,key,{value:value,enumerable:!0,configurable:!0,writable:!0}):obj[key]=value,obj}function _classCallCheck(instance,Constructor){if(!(instance instanceof Constructor))throw new TypeError('Cannot call a class as a function')}// utilities
function getLength(a,b,c,e){// returns the length of a line segment
var f=c-a,g=e-b;return Math.sqrt(f*f+g*g)}function getDegAngle(a,b,c,e){return Math.atan2(e-b,c-a)*(180/Math.PI)}// some constants
var DECAY=4,SPREAD=60,GRAVITY=1200;// confetti decay in seconds
// degrees to spread from the angle of the cannon
var ConfettiCannon=function(){function ConfettiCannon(){_classCallCheck(this,ConfettiCannon),this.canvas=document.getElementById('canvas'),this.dpr=window.devicePixelRatio||1,this.ctx=this.canvas.getContext('2d'),this.ctx.scale(this.dpr,this.dpr),this.confettiSpriteIds=[],this.confettiSprites={},this.drawVector=!1,this.vector=[{x:window.innerWidth,y:1.25*window.innerHeight},{x:window.innerWidth,y:2*window.innerHeight}],this.pointer={},this.render=this.render.bind(this),this.handleMousedown=this.handleMousedown.bind(this),this.handleMouseup=this.handleMouseup.bind(this),this.handleMousemove=this.handleMousemove.bind(this),this.handleTouchstart=this.handleTouchstart.bind(this),this.handleTouchmove=this.handleTouchmove.bind(this),this.setCanvasSize=this.setCanvasSize.bind(this),this.setupListeners(),this.setCanvasSize(),this.timer=setTimeout(this.handleMouseup,1e3)}return _createClass(ConfettiCannon,[{key:'setupListeners',value:function setupListeners(){TweenLite.ticker.addEventListener('tick',this.render),window.addEventListener('mousedown',this.handleMousedown),window.addEventListener('mouseup',this.handleMouseup),window.addEventListener('mousemove',this.handleMousemove),window.addEventListener('touchstart',this.handleTouchstart),window.addEventListener('touchend',this.handleMouseup),window.addEventListener('touchmove',this.handleTouchmove),window.addEventListener('resize',this.setCanvasSize)}},{key:'setCanvasSize',value:function setCanvasSize(){this.canvas.width=window.innerWidth*this.dpr,this.canvas.height=window.innerHeight*this.dpr,this.canvas.style.width=window.innerWidth+'px',this.canvas.style.height=window.innerHeight+'px'}},{key:'handleMousedown',value:function handleMousedown(a){clearTimeout(this.timer);var b=a.clientX*this.dpr,c=a.clientY*this.dpr;this.vector[0]={x:b,y:c},this.drawVector=!0}},{key:'handleTouchstart',value:function handleTouchstart(a){clearTimeout(this.timer),a.preventDefault();var b=a.touches[0].clientX*this.dpr,c=a.touches[0].clientY*this.dpr;this.vector[0]={x:b,y:c},this.drawVector=!0}},{key:'handleMouseup',value:function handleMouseup(){this.drawVector=!1;var a=this.vector[0].x,b=this.vector[0].y,c=this.vector[1].x,e=this.vector[1].y,f=getLength(a,b,c,e),g=getDegAngle(a,b,c,e)+180;this.addConfettiParticles(f/5+5,g,10*f,a,b)}},{key:'handleMousemove',value:function handleMousemove(a){var b=a.clientX*this.dpr,c=a.clientY*this.dpr;this.vector[1]={x:b,y:c},this.pointer=this.vector[1]}},{key:'handleTouchmove',value:function handleTouchmove(a){a.preventDefault();var b=a.changedTouches[0].clientX*this.dpr,c=a.changedTouches[0].clientY*this.dpr;this.vector[1]={x:b,y:c},this.pointer=this.vector[1]}},{key:'drawVectorLine',value:function drawVectorLine(){this.ctx.strokeStyle='pink',this.ctx.lineWidth=2*this.dpr;var a=this.vector[0].x,b=this.vector[0].y,c=this.vector[1].x,e=this.vector[1].y;this.ctx.beginPath(),this.ctx.moveTo(a,b),this.ctx.lineTo(c,e),this.ctx.stroke()}},{key:'addConfettiParticles',value:function addConfettiParticles(a,b,c,e,f){for(var g=0;g<a;){// sprite
var h=_.random(4,6)*this.dpr,j=_.random(15,25)*this.dpr,k=_.random(30,255),l=_.random(30,230),m=_.random(30,230),n='rgb('+k+', '+l+', '+m+')',o=_.random(10,-10),p=_.random(0.07,0.05),q=_.uniqueId();Object.assign(this.confettiSprites,_defineProperty({},q,{angle:b,velocity:c,x:e,y:f,r:h,d:j,color:n,tilt:o,tiltAngleIncremental:p,tiltAngle:0})),this.confettiSpriteIds.push(q),this.tweenConfettiParticle(q),g++}}},{key:'tweenConfettiParticle',value:function tweenConfettiParticle(a){var _this=this,b=this.confettiSprites[a].angle-SPREAD/2,c=this.confettiSprites[a].angle+SPREAD/2,e=this.confettiSprites[a].velocity/4,f=this.confettiSprites[a].velocity,g=_.random(e,f),h=_.random(b,c),j=_.random(0.1,0.25);TweenLite.to(this.confettiSprites[a],DECAY,{physics2D:{velocity:g,angle:h,gravity:GRAVITY,friction:j},d:0,ease:Power4.easeIn,onComplete:function onComplete(){_.pull(_this.confettiSpriteIds,a),delete _this.confettiSprites[a]}})}},{key:'updateConfettiParticle',value:function updateConfettiParticle(a){var b=this.confettiSprites[a],c=5e-4*b.d;b.angle+=0.01,b.tiltAngle+=c,b.tiltAngle+=b.tiltAngleIncremental,b.tilt=2*(Math.sin(b.tiltAngle-b.r/2)*b.r),b.y+=2*Math.sin(b.angle+b.r/2),b.x+=Math.cos(b.angle)/2}},{key:'drawConfetti',value:function drawConfetti(){var _this2=this;this.confettiSpriteIds.map(function(a){var b=_this2.confettiSprites[a];_this2.ctx.beginPath(),_this2.ctx.lineWidth=b.d/2,_this2.ctx.strokeStyle=b.color,_this2.ctx.moveTo(b.x+b.tilt+b.r,b.y),_this2.ctx.lineTo(b.x+b.tilt,b.y+b.tilt+b.r),_this2.ctx.stroke(),_this2.updateConfettiParticle(a)})}},{key:'drawPointer',value:function drawPointer(){var a=this.pointer.x,b=this.pointer.y,c=15*this.dpr;this.ctx.beginPath(),this.ctx.arc(a,b,c,0,2*Math.PI,!1),this.ctx.fillStyle='transparent',this.ctx.fill(),this.ctx.lineWidth=2*this.dpr,this.ctx.strokeStyle='#ffffff',this.ctx.stroke()}},{key:'drawPower',value:function drawPower(){var a=this.vector[0].x,b=this.vector[0].y,c=this.vector[1].x,e=this.vector[1].y,f=getLength(a,b,c,e),g=1*this.dpr*f/20;this.ctx.beginPath(),this.ctx.arc(a,b,g,0,2*Math.PI,!1),this.ctx.fillStyle='transparent',this.ctx.fill(),this.ctx.lineWidth=2*this.dpr,this.ctx.strokeStyle='#333333',this.ctx.stroke()}},{key:'render',value:function render(){this.ctx.clearRect(0,0,this.canvas.width,this.canvas.height),this.drawVector&&this.drawVectorLine(),this.drawVector&&this.drawPower(),this.drawPointer(),this.drawConfetti()}}]),ConfettiCannon}();var confetti=new ConfettiCannon;